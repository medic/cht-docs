{{ $id := .Get "id" | default (now.UnixNano) }}

<!-- Load external CSS -->
{{ $css := resources.Get "css/cost-calculator.css" }}
<link rel="stylesheet" href="{{ $css.RelPermalink }}">

<!-- Load external JavaScript -->
<script src="/js/cost-calculator.js"></script>

<div class="cht-cost-calculator" id="calc-container-{{ $id }}">
  <div class="calc-loading" id="loading-{{ $id }}">
    Loading Chart.js...
  </div>

  <div class="calc-grid">
    <!-- Input Controls -->
    <div class="calc-inputs">
      <h3>Configuration</h3>

      <div class="input-group">
        <label class="label-with-value">
          <span>Active Users</span>
          <span class="input-value" id="active-users-value-{{ $id }}">661</span>
        </label>
        <input type="range"
               class="calc-input"
               id="active-users-{{ $id }}"
               min="1"
               max="5000"
               value="661"
               step="1">
      </div>

      <div class="input-group">
        <label for="doc-growth-{{ $id }}">Document Growth (per month)</label>
        <input type="number"
               class="calc-input"
               id="doc-growth-{{ $id }}"
               value="248000"
               min="0"
               step="1000">
      </div>

      <div class="input-group">
        <label for="db-size-{{ $id }}">Current Database Size (million documents)</label>
        <input type="number"
               class="calc-input"
               id="db-size-{{ $id }}"
               value="10.7"
               min="0"
               step="0.1">
      </div>

      <div class="input-group">
        <label for="deployment-type-{{ $id }}">Deployment Type</label>
        <select class="calc-input" id="deployment-type-{{ $id }}">
          <option value="small" selected>Small (1 control + 3 workers)</option>
          <option value="medium">Medium (1 control + 5 workers)</option>
          <option value="large">Large (1 control + 10 workers)</option>
        </select>
      </div>

      <div class="input-group">
        <label for="cloud-provider-{{ $id }}">Cloud Provider / Region</label>
        <select class="calc-input" id="cloud-provider-{{ $id }}">
          <option value="1.0" selected>AWS Paris (eu-west-2)</option>
          <option value="0.95">AWS US East (us-east-1)</option>
          <option value="1.1">AWS Asia Pacific (ap-south-1)</option>
          <option value="0.8">Self-hosted Datacenter</option>
        </select>
      </div>

      <div class="input-group">
        <label class="label-with-value">
          <span>Over-provisioning Buffer</span>
          <span class="input-value" id="overprovision-value-{{ $id }}">20%</span>
        </label>
        <input type="range"
               class="calc-input"
               id="overprovision-{{ $id }}"
               min="0"
               max="50"
               value="20"
               step="1">
      </div>

      <div class="input-group">
        <label class="label-with-value">
          <span>Backup Storage Multiplier</span>
          <span class="input-value" id="backup-mult-value-{{ $id }}">2x</span>
        </label>
        <input type="range"
               class="calc-input"
               id="backup-mult-{{ $id }}"
               min="1"
               max="5"
               value="2"
               step="0.5">
      </div>

      <div class="input-group">
        <label class="checkbox-label">
          <input type="checkbox"
                 class="calc-input"
                 id="include-backups-{{ $id }}">
          Include Backup Costs
        </label>
      </div>

      <div class="input-group">
        <label class="checkbox-label">
          <input type="checkbox"
                 class="calc-input"
                 id="include-monitoring-{{ $id }}"
                 checked>
          Include Monitoring Costs
        </label>
      </div>

      <div class="input-group">
        <label for="projection-period-{{ $id }}">Growth Projection Period</label>
        <select class="calc-input" id="projection-period-{{ $id }}">
          <option value="3">3 months</option>
          <option value="6">6 months</option>
          <option value="12" selected>12 months</option>
          <option value="24">24 months</option>
        </select>
      </div>
    </div>

    <!-- Charts -->
    <div class="calc-charts">
      <div class="chart-container">
        <h3>Cost Breakdown</h3>
        <canvas id="pie-chart-{{ $id }}" class="chart-canvas"></canvas>
      </div>

      <div class="chart-container">
        <h3>Growth Projection</h3>
        <canvas id="bar-chart-{{ $id }}" class="chart-canvas"></canvas>
      </div>
    </div>
  </div>

  <!-- Detailed Table -->
  <div class="calc-table">
    <h3>Detailed Cost Breakdown</h3>
    <table class="cost-breakdown-table">
      <thead>
        <tr>
          <th>Cost Component</th>
          <th>Details</th>
          <th class="cost-amount">Monthly Cost</th>
        </tr>
      </thead>
      <tbody id="cost-table-body-{{ $id }}">
        <!-- Populated by JavaScript -->
      </tbody>
      <tfoot>
        <tr>
          <td colspan="2">Total Monthly Cost</td>
          <td class="cost-amount" id="total-cost-{{ $id }}">$0.00</td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

<script>
  // Initialize the calculator for this instance
  initCostCalculator('{{ $id }}');
</script>
