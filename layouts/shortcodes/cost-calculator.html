{{ $id := .Get "id" | default (now.UnixNano) }}

<!-- Load external CSS -->
{{ $css := resources.Get "css/cost-calculator.css" }}
<link rel="stylesheet" href="{{ $css.RelPermalink }}">

<!-- Load external JavaScript -->
<script src="/js/cost-calculator.js"></script>

<div class="cht-cost-calculator" id="calc-container-{{ $id }}">
  <div class="calc-grid">
    <!-- Input Controls - Basic -->
    <div class="calc-inputs" id="basic-params-{{ $id }}">
      <h3>Deployment Parameters</h3>

      <div class="input-group">
        <label class="label-with-value">
          <span>Population Served</span>
          <span class="input-value" id="population-count-value-{{ $id }}">20,000</span>
        </label>
        <input type="range"
               class="calc-input"
               id="population-count-{{ $id }}"
               min="1000"
               max="1000000"
               value="20000"
               step="1000">
      </div>

      <div class="input-group">
        <label class="label-with-value">
          <span>Number of Workflows</span>
          <span class="input-value" id="workflow-count-value-{{ $id }}">5</span>
        </label>
        <input type="range"
               class="calc-input"
               id="workflow-count-{{ $id }}"
               min="1"
               max="25"
               value="5"
               step="1">
      </div>

      <div class="input-group">
        <label class="label-with-value">
          <span>Age of Deployment (years)</span>
          <span class="input-value" id="deployment-age-value-{{ $id }}">1</span>
        </label>
        <input type="range"
               class="calc-input"
               id="deployment-age-{{ $id }}"
               min="1"
               max="10"
               value="1"
               step="1">
      </div>

      <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--calc-border);">
        <a href="#"
           id="show-advanced-{{ $id }}"
           style="color: #3b82f6; text-decoration: none; font-size: 0.9rem; font-weight: 500;"
           onclick="event.preventDefault();">
          Advanced →
        </a>
      </div>
    </div>

    <!-- Input Controls - Advanced -->
    <div class="calc-inputs" id="advanced-params-{{ $id }}" style="display: none;">
      <h3>Advanced Parameters</h3>

      <div class="input-group">
        <label for="contacts-per-place-{{ $id }}">Average Household Size</label>
        <input type="number"
               class="calc-input"
               id="contacts-per-place-{{ $id }}"
               value="5"
               min="2"
               step="1">
        <div style="font-size: 0.8rem; color: var(--calc-text-light); margin-top: 0.25rem;">
          Number of contacts in each geographic location
        </div>
      </div>

      <div class="input-group">
        <label for="workflow-docs-{{ $id }}">Workflow Docs Per Contact</label>
        <input type="number"
               class="calc-input"
               id="workflow-docs-{{ $id }}"
               value="12"
               min="1"
               step="1">
        <div style="font-size: 0.8rem; color: var(--calc-text-light); margin-top: 0.25rem;">
          Documents generated per contact per workflow per year
        </div>
      </div>

      <div class="input-group">
        <label for="db-overprovision-{{ $id }}">Database Over-provisioning Factor</label>
        <input type="number"
               class="calc-input"
               id="db-overprovision-{{ $id }}"
               value="2"
               min="1"
               max="10"
               step="0.5">
        <div style="font-size: 0.8rem; color: var(--calc-text-light); margin-top: 0.25rem;">
          Multiplier for database storage headroom
        </div>
      </div>

      <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--calc-border);">
        <a href="#"
           id="show-basic-{{ $id }}"
           style="color: #3b82f6; text-decoration: none; font-size: 0.9rem; font-weight: 500;"
           onclick="event.preventDefault();">
          ← Back to Basic
        </a>
      </div>
    </div>

    <!-- Results Summary -->
    <div class="calc-charts">
      <div class="chart-container">
        <h3>Annual Cost Estimate</h3>
        <div style="text-align: center;">
          <div style="font-size: 2.5rem; font-weight: bold; color: #3b82f6; margin-bottom: 0.5rem;" id="total-cost-{{ $id }}">$0.00</div>
          <div class="calc-loading" id="loading-{{ $id }}">
            Loading Chart.js...
          </div>
          <canvas id="cost-pie-chart-{{ $id }}" class="chart-canvas" style="max-height: 250px;"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Host and User Info Row -->
  <div style="display: flex; gap: 1.5rem; margin-bottom: 1.5rem;">

    <!-- User Count -->
    <div class="calc-table" style="flex: 0.75;">
      <h3>Estimated Users</h3>
      <div style="padding: 1rem 0; text-align: center;">
        <div style="font-size: 3rem; font-weight: bold; color: #f59e0b; margin-bottom: 0.5rem;" id="user-count-{{ $id }}">0</div>
        <div style="font-size: 0.9rem; color: var(--calc-text-light);">Number of users</div>
      </div>
    </div>

    <!-- Recommended Host -->
    <div class="calc-table" style="flex: 2;">
      <h3>Recommended Host</h3>
      <div style="display: grid; grid-template-columns: 1.5fr 1fr; ">
        <div>
          <div style="font-size: 0.875rem; font-weight: 600; color: var(--calc-text-light); margin-bottom: 0.5rem; text-transform: uppercase;">Instance</div>
          <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;" id="instance-size-{{ $id }}">4 GB RAM + 2 CPU</div>
          <div style="font-size: 0.95rem; color: var(--calc-text-light); margin-bottom: 0.5rem;" id="instance-name-{{ $id }}">EC2: t3.medium</div>
          <div style="font-size: 1.5rem; font-weight: 600; color: #3b82f6;" id="instance-cost-{{ $id }}">$0.00</div>
        </div>
        <div>
          <div style="font-size: 0.875rem; font-weight: 600; color: var(--calc-text-light); margin-bottom: 0.5rem; text-transform: uppercase;">Disk</div>
          <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;" id="disk-size-{{ $id }}">0 GB</div>
          <div style="font-size: 0.95rem; color: var(--calc-text-light); margin-bottom: 0.5rem;">Block Volume Storage</div>
          <div style="font-size: 1.5rem; font-weight: 600; color: #10b981;" id="disk-cost-{{ $id }}">$0.00</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Initialize the calculator for this instance
  initCostCalculator('{{ $id }}');
</script>
