{{ $id := .Get "id" | default (now.UnixNano) }}

{{ $css := resources.Get "css/cost-calculator.css" }}
<link rel="stylesheet" href="{{ $css.RelPermalink }}">

<script src="/js/cost-calculator.js"></script>

<div class="cht-cost-calculator" id="calc-container-{{ $id }}">
  <div class="calc-grid">
    <div class="calc-card params" id="basic-params-{{ $id }}">
      <h3>Deployment Parameters</h3>

      <label class="label-with-value">
        <span>Population Served</span>
        <span class="input-value" id="population-count-value-{{ $id }}">20,000</span>
      </label>
      <input type="range" class="calc-input" id="population-count-{{ $id }}" min="1000" max="1000000" value="20000" step="1000">

      <label class="label-with-value">
        <span>Number of Workflows</span>
        <span class="input-value" id="workflow-count-value-{{ $id }}">5</span>
      </label>
      <input type="range" class="calc-input" id="workflow-count-{{ $id }}" min="1" max="25" value="5" step="1">

      <label class="label-with-value">
        <span>Age of Deployment (years)</span>
        <span class="input-value" id="deployment-age-value-{{ $id }}">1</span>
      </label>
      <input type="range" class="calc-input" id="deployment-age-{{ $id }}" min="1" max="10" value="1" step="1">

      <label class="label-with-value">
        <span>Number of Users</span>
        <span class="input-value" id="user-count-input-value-{{ $id }}">100</span>
      </label>
      <input type="range" class="calc-input" id="user-count-input-{{ $id }}" min="1" max="15000" value="100" step="1">

      <div class="viz-divider">
        <a href="#" id="show-advanced-{{ $id }}" class="calc-link" onclick="event.preventDefault();">Advanced →</a>
      </div>
    </div>

    <!-- Advanced Parameters -->
    <div class="calc-card params hidden" id="advanced-params-{{ $id }}">
      <h3>Advanced Parameters</h3>

      <div class="advanced-input-group">
        <div class="advanced-input">
          <label for="contacts-per-place-{{ $id }}">Average Household Size</label>
          <input type="number" class="calc-input" id="contacts-per-place-{{ $id }}" value="5" min="2" step="1">
        </div>
        <div class="helper-text">Number of contacts in each geographic location</div>
      </div>

      <div class="advanced-input-group">
        <div class="advanced-input">
          <label for="workflow-docs-{{ $id }}">Workflow Docs Per Contact</label>
          <input type="number" class="calc-input" id="workflow-docs-{{ $id }}" value="12" min="1" step="1">
        </div>
        <div class="helper-text">Documents generated per contact per workflow per year</div>
      </div>

      <div class="advanced-input-group">
        <div class="advanced-input">
          <label for="db-overprovision-{{ $id }}">Database Over-provisioning Factor</label>
          <input type="number" class="calc-input" id="db-overprovision-{{ $id }}" value="2" min="1" max="10" step="0.5">
        </div>
        <div class="helper-text">Multiplier for database storage headroom</div>
      </div>

      <div class="viz-divider">
        <a href="#" id="show-basic-{{ $id }}" class="calc-link" onclick="event.preventDefault();">← Back to Basic</a>
      </div>
    </div>

    <!-- Annual Cost Estimate -->
    <div class="calc-card cost">
      <h3>Annual Cost Estimate</h3>
      <div class="total-cost" id="total-cost-{{ $id }}">$0.00</div>
      <div class="monthly-cost">
        <span id="monthly-cost-{{ $id }}">$0.00</span>/month
      </div>
      <div class="calc-loading" id="loading-{{ $id }}">Loading Chart.js...</div>
      <canvas id="cost-pie-chart-{{ $id }}" />
    </div>

    <!-- Users -->
    <div class="calc-card users">
      <h3>Users</h3>
      <div class="viz-section people-per">
        <div class="viz-label">People per User</div>
        <div class="viz-value " id="pop-per-user-{{ $id }}">0</div>
        <div class="range-bar">
          <div class="range-marker" id="pop-per-user-marker-{{ $id }}"></div>
        </div>
        <div class="range-labels"><span>1</span><span>250</span></div>
      </div>

      <div class="viz-section viz-divider docs-per">
        <div class="viz-label">Docs per User</div>
        <div class="viz-value" id="docs-per-user-{{ $id }}">0</div>
        <div class="range-bar">
          <div class="range-marker" id="docs-per-user-marker-{{ $id }}"></div>
        </div>
        <div class="range-labels"><span>1</span><span>20,000</span></div>
      </div>
    </div>

    <!-- Recommended Host -->
    <div class="calc-card host">
      <h3>Recommended Host</h3>
      <div class="host-grid">
        <!-- Instance -->
        <div>
          <div class="host-section-header">Instance</div>
          <div class="host-value-large" id="instance-size-{{ $id }}">4 GB RAM + 2 CPU</div>
          <div class="host-description" id="instance-name-{{ $id }}">EC2: t3.medium</div>
          <div class="host-cost-primary" id="instance-cost-{{ $id }}">$0.00</div>

          <div class="viz-divider">
            <div class="viz-label">Resource Utilization</div>
            <div class="resource-util-value" id="resource-util-{{ $id }}">0%</div>
            <div class="resource-util-bar">
              <div class="resource-util-marker" id="resource-util-marker-{{ $id }}"></div>
            </div>
            <div class="range-labels"><span>0%</span><span>100%</span></div>
          </div>
        </div>

        <!-- Disk -->
        <div>
          <div class="host-section-header">Disk</div>
          <div class="host-value-large" id="disk-size-{{ $id }}">0 GB</div>
          <div class="host-description">Block Volume Storage</div>
          <div class="host-cost-secondary" id="disk-cost-{{ $id }}">$0.00</div>

          <div class="viz-divider">
            <div class="viz-label">Storage Breakdown</div>
            <div class="breakdown-row">
              <div class="breakdown-label">Used</div>
              <div class="breakdown-value text-blue" id="disk-used-{{ $id }}">0 GB</div>
            </div>
            <div class="breakdown-row">
              <div class="breakdown-label">Overprovisioned</div>
              <div class="breakdown-value text-orange" id="disk-overprovision-{{ $id }}">0 GB</div>
            </div>
            <div class="disk-bar">
              <div class="disk-bar-segment disk-bar-segment-used" id="disk-used-bar-{{ $id }}"></div>
              <div class="disk-bar-segment disk-bar-segment-overprovision" id="disk-overprovision-bar-{{ $id }}"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  initCostCalculator('{{ $id }}');
</script>
