{{ $id := .Get "id" | default (now.UnixNano) }}

<!-- Load external CSS -->
{{ $css := resources.Get "css/cost-calculator.css" }}
<link rel="stylesheet" href="{{ $css.RelPermalink }}">

<!-- Load external JavaScript -->
<script src="/js/cost-calculator.js"></script>

<div class="cht-cost-calculator" id="calc-container-{{ $id }}">
  <div class="calc-grid">
    <!-- Input Controls -->
    <div class="calc-inputs">
      <h3>Deployment Parameters</h3>

      <div class="input-group">
        <label class="label-with-value">
          <span>Age of Deployment (years)</span>
          <span class="input-value" id="deployment-age-value-{{ $id }}">1</span>
        </label>
        <input type="range"
               class="calc-input"
               id="deployment-age-{{ $id }}"
               min="1"
               max="10"
               value="1"
               step="1">
      </div>

      <div class="input-group">
        <label class="label-with-value">
          <span>Number of Workflows</span>
          <span class="input-value" id="workflow-count-value-{{ $id }}">5</span>
        </label>
        <input type="range"
               class="calc-input"
               id="workflow-count-{{ $id }}"
               min="1"
               max="25"
               value="5"
               step="1">
      </div>

      <div class="input-group">
        <label class="label-with-value">
          <span>Population Served</span>
          <span class="input-value" id="population-count-value-{{ $id }}">20,000</span>
        </label>
        <input type="range"
               class="calc-input"
               id="population-count-{{ $id }}"
               min="1000"
               max="1000000"
               value="20000"
               step="1000">
      </div>
    </div>

    <!-- Results Summary -->
    <div class="calc-charts">
      <div class="chart-container">
        <h3>Annual Cost Estimate</h3>
        <div style="text-align: center;">
          <div style="font-size: 2.5rem; font-weight: bold; color: #3b82f6; margin-bottom: 0.5rem;" id="total-cost-{{ $id }}">$0.00</div>
          <div class="calc-loading" id="loading-{{ $id }}">
            Loading Chart.js...
          </div>
          <canvas id="cost-pie-chart-{{ $id }}" class="chart-canvas" style="max-height: 250px;"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Instance Details -->
  <div class="calc-table" style="margin-bottom: 1.5rem;">
    <h3>Instance Selection</h3>
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0;">
      <div>
        <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;" id="instance-name-{{ $id }}">t3.medium</div>
        <div style="font-size: 0.95rem; color: var(--calc-text-light);" id="instance-size-{{ $id }}">4 GB RAM + 2 CPU</div>
      </div>
      <div style="font-size: 1.5rem; font-weight: 600; color: #3b82f6;" id="instance-cost-{{ $id }}">$0.00</div>
    </div>
  </div>

  <!-- Detailed Breakdown Table -->
  <div class="calc-table">
    <h3>Detailed Breakdown</h3>
    <table class="cost-breakdown-table">
      <thead>
        <tr>
          <th>Metric</th>
          <th>Description</th>
          <th class="cost-amount">Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Disk Cost</strong></td>
          <td>Storage cost per year</td>
          <td class="cost-amount" id="disk-cost-{{ $id }}">$0.00</td>
        </tr>
        <tr>
          <td><strong>User Count</strong></td>
          <td>Estimated number of users</td>
          <td class="cost-amount" id="user-count-{{ $id }}">0</td>
        </tr>
        <tr>
          <td><strong>Contact Count</strong></td>
          <td>Total contacts in database</td>
          <td class="cost-amount" id="contact-count-{{ $id }}">0</td>
        </tr>
        <tr>
          <td><strong>Report Count</strong></td>
          <td>Total reports generated</td>
          <td class="cost-amount" id="report-count-{{ $id }}">0</td>
        </tr>
        <tr>
          <td><strong>Place Count</strong></td>
          <td>Number of places tracked</td>
          <td class="cost-amount" id="place-count-{{ $id }}">0</td>
        </tr>
        <tr>
          <td><strong>Total Documents</strong></td>
          <td>All documents in database</td>
          <td class="cost-amount" id="total-doc-count-{{ $id }}">0</td>
        </tr>
        <tr>
          <td><strong>Disk Size</strong></td>
          <td>Required disk space</td>
          <td class="cost-amount" id="disk-size-{{ $id }}">0 GB</td>
        </tr>
        <tr>
          <td><strong>Load Factor</strong></td>
          <td>System load metric</td>
          <td class="cost-amount" id="load-factor-{{ $id }}">0</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<script>
  // Initialize the calculator for this instance
  initCostCalculator('{{ $id }}');
</script>
