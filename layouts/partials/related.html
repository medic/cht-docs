{{ $parent := .Page }}
{{ with .Params.relatedContent }}
{{ $pages := split . " " }}
<h2>Related Content</h2>
<div class="section-index">
	{{ if $parent.Params.simple_list }}
	{{/* If simple_list is true we show a bulleted list of subpages */}}
	<ul>
		{{ range $pages }}
		{{ with $.Site.GetPage . }}
		<li><a href="{{ .RelPermalink }}">{{- .Title -}}</a></li>
		{{ end }}
		{{ end }}
	</ul>
	{{ else }}
	{{/* Otherwise we show a nice formatted list of subpages with page descriptions */}}
	<hr class="panel-line">
	{{ range $pages }}
	{{ $path := trim . " \n" }}
	{{ $page := $.Site.GetPage $path }}
	{{ if not $page }}
	{{ if (eq $.Site.Params.linkErrorLevel "WARNING") }}
	{{ warnf "[relatedContent] REF_NOT_FOUND: Ref \"%s\": \"%s\": page not found" $path $parent.File.Path }}
	{{ else }}
	{{ errorf "[relatedContent] REF_NOT_FOUND: Ref \"%s\": \"%s\": page not found" $path $parent.File.Path }}
	{{ end }}
	{{ end }}
	{{ with $page }}
	<div class="entry">
		<h5>
			<a href="{{ .RelPermalink }}">{{ template "relatedcontenttitle" (dict "p1" $page "p2" $page) }}</a>
			{{/* <a href="{{ .RelPermalink }}">{{- .Title -}}</a> */}}
		</h5>
		<p>{{ $page.Description | markdownify }}</p>
	</div>
	{{ end }}
	{{ end }}
	{{ end }}
</div>
{{ end }}
{{ define "relatedcontenttitle" }}
	{{ if .p1.Parent }}
		{{ if not .p1.Parent.IsHome }}
		{{ template "relatedcontenttitle" (dict "p1" .p1.Parent "p2" .p2 )  }}
		{{ end }}
	{{ else if not .p1.IsHome }}
		{{ template "relatedcontenttitle" (dict "p1" .p1.Site.Home "p2" .p2 )  }}
	{{ end }}
		{{ if not (eq .p1 .p2) }}
		{{ .p1.LinkTitle }} >
		{{ else }}
		{{ .p1.Title }}
		{{ end }}
{{ end }}